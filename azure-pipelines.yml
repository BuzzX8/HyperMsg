name: HyperMsg.Core
jobs:
- job: BuildAndTest
  displayName: 'Build and Test'
  steps:
    - task: DotNetCoreCLI@2
      name: build
      displayName: Build
      inputs:
        command: build
        projects: src/**/*.csproj
    - task: DotNetCoreCLI@2
      name: test
      displayName: Test
      inputs:
        command: test
        projects: test/**/*.csproj
    - task: PublishBuildArtifacts@1
      name: PublishBuildArtifacts
      displayName: Publish build artifacts      
      inputs:
        artifactName: 'drop'
        pathtoPublish: '$(Build.ArtifactStagingDirectory)'
- job: publish
  displayName: 'Publish package'
  dependsOn: BuildAndTest
  steps:
    - task: DotNetCoreCLI@2
      name: pack
      displayName: 'Create NuGet package'
      inputs:
        command: 'pack'
        searchPatternPack: 'src/**/*.csproj'
        nobuild: true
        majorVersion: 0
        minorVersion: 0
        patchVersion: $(Build.BuildId)
        versioningScheme: byPrereleaseNumber